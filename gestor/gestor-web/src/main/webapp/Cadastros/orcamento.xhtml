<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:head>
        <title>Gestor - Venda</title>
    </h:head>

    <style type="text/css"> 
        .border {
            border: 1px solid #000;

            .column1{
                width: 30%;
            }
            column2{
                width: 70%;
            }
            .ui-widget {
                font-size: 12px !important;
            }
            .columnCidade1{}
            .columnCidade2{
                vertical-align: bottom;
            }
            .columnBtn1{
                width: 20% !important;
            }
            .columnBtn2{
                width: 60% !important;
            }
            .columnBtn3{
                width: 20% !important;
            }
            .cabecalho1{
                width:  30% !important;
            }
            .cabecalho2{
                width:  70% !important;
            }
            .totalizadores1{
                width:  20%;
            }
            .totalizadores2{
                width:  20%;
            }
            .totalizadores3{
                width:  20%;
            }
            .totalizadores4{
                width:  20%;
            }
            .totalizadores5{
                width:  20%;
            }
            .gray {
                color: black !important;
                font-weight: bold !important;
                background-color: #dfdfdf;
            }
            .columnConf1{
                vertical-align: bottom;
            }
            .columnConf2{
                vertical-align: bottom;
            }
        </style>
        <script>
            function somenteNumeros(num) {
                var er = /[^0-9.]/;
                er.lastIndex = 0;
                var campo = num;
                if (er.test(campo.value)) {
                    campo.value = "";
                    alert("Utilize apenas números e substitua vírgula(,) por ponto (.)");
                }
            }
        </script>
        <h:body style="background-color: white ; background-size: 100%">
                <h:form id="form" style="height: 100% !important">
                    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" />
                    <p:outputPanel autoUpdate="true">
                        <h:panelGrid columns="4" cellpadding="3" cellspacing="3" style="width: 100%; ; background-color: lightsteelblue; ">
                        <h:graphicImage url="/Images/orcamento.png"  width="30px" height="30px" /> 
                        <p:outputLabel value="VENDA" style="font-size: large !important; color: white;  font-weight: bold" />
                            <h:outputLink target="_blank" value="https://youtu.be/MDdWzj5SPYI">ASSISTA AQUI O TUTORIAL</h:outputLink>
                            <p:outputPanel >
                                <p:commandButton  disabled="#{orcamentoController.disableAllFields}"  onclick="PF('dlgConfirmacao').show();"  rendered="#{orcamentoController.orcamento ne null}" value="SALVAR" style="color: white; background-color: green; float: right; font-weight: bold"   />
                                <p:commandButton  actionListener="#{orcamentoController.cancelar()}" rendered="#{orcamentoController.orcamento ne null}" value="SAIR" style="color: white; background-color:grey ; float: right; border: none" />
                                <p:commandButton  actionListener="#{orcamentoController.novo()}" rendered="#{orcamentoController.orcamento eq null}" value="NOVO" style="color: white; background-color: darkturquoise; float: right; font-weight: bold" />
                                <p:commandButton actionListener="#{orcamentoController.fechar()}" ajax="false"  rendered="#{orcamentoController.orcamento eq null}"  value="FECHAR" style="color: white; background-color: red; float: right; border: none" />
                                <p:commandButton value="Exclusao" actionListener="#{orcamentoController.excluir()}"  rendered="#{orcamentoController.orcamento.id ne null and orcamentoController.orcamento.status ne 'CANCELADO'}" 
                                                 update="messages" style="color: white; background-color:black ; float: right"  >
                                    <p:confirm header="Confirmacao" message="Deseja realmente excluir o Registro? O orçamento será cancelado e seu vinculo financeiro será excluido/estornado." icon="ui-icon-alert" />
                                </p:commandButton>
                            </p:outputPanel>
                        </h:panelGrid>
                        <br/>
                        <h:panelGrid  rendered="#{orcamentoController.orcamento ne null}" columns="1" style="width: 100%;background-color: white ">
                            <h:panelGrid columns="2" style="width: 98%; margin-left:  1%" columnClasses="cabecalho1,cabecalho2">

                                <p:column >
                                    <p:column width="40%">
                                        <h:panelGrid columns="2" cellpadding="10" cellspacing="10" style="width: 99%; padding: 5px !important" >
                                            <p:column>
                                                <p:selectOneRadio id="selectOneVenda" value="#{orcamentoController.venda}"
                                                                  style="width: 90%" disabled="#{orcamentoController.disableAllFields}"  
                                                                  rendered="#{orcamentoController.orcamento ne null and orcamentoController.orcamento.status ne 'CANCELADO'}" >
                                                    <f:selectItem itemLabel="Venda"  itemValue="true" />
                                                    <f:selectItem itemLabel="Orçamento" itemValue="false" />
                                                    <p:ajax event="change"  listener="#{orcamentoController.validarPreVenda()}" update="@this,dlgConfirmacao"/>
                                                </p:selectOneRadio>

                                            </p:column>
                                            <p:column rendered="#{orcamentoController.venda}">
                                                <p:outputLabel value="Data da venda" style="font-weight: bold" /> <br/>
                                                <p:calendar  value="#{orcamentoController.orcamento.dataVenda}"  pattern="dd/MM/yyyy" mask="true" 
                                                             disabled="#{orcamentoController.disableAllFields}"   />
                                            </p:column>
                                        </h:panelGrid>
                                    </p:column>

                                </p:column>
                                <p:column  >
                                    <p:column >
                                        <h:panelGrid columns="5" style="width: 100%; " cellpadding="3" cellspacing="3" columnClasses="totalizadores1,totalizadores2,totalizadores3,totalizadores4,totalizadores5">
                                        <p:column style="max-width: 100px" >
                                                <h:panelGrid columns="1" style="background-color: lightslategrey;  width: 99%;border-radius: 10px 20px; float: right"  
                                                             rendered="#{not empty orcamentoController.orcamento}" >
                                                    <p:outputLabel  value="Total comissões" style="color: white; margin-left: 5%" />
                                                    <p:outputLabel value="#{orcamentoController.orcamento.valorComissao}" style="color: white; margin-left: 5%" 
                                                                   rendered="#{not usuarioController.empresa.permiteAlterarComissao}" >
                                                        <f:convertNumber currencySymbol="R$" type="currency"/>
                                                    </p:outputLabel>
                                                    <p:inputText value="#{orcamentoController.totalComissao}" onkeyup="somenteNumeros(this);"  
                                                                 style="margin-left: 5%;margin-bottom: 1%; width: 80%; text-align: right" 
                                                                 rendered="#{ usuarioController.empresa.permiteAlterarComissao}"
                                                                 disabled="#{orcamentoController.disableAllFields}" >   
                                                        <p:ajax event="change" update="@this"  listener="#{orcamentoController.aplicarComissaoManual()}" />
                                                    </p:inputText>
                                                </h:panelGrid>
                                            </p:column>
                                            <p:column rendered="#{usuarioController.empresa.ramoAtividade.chave eq 'FABRICA' and orcamentoController.existeInsumos}" > 
                                                <h:panelGrid columns="1" style="background-color: cornflowerblue; width: 99%;border-radius: 10px 20px; float: right;width: 100%" 
                                                             rendered="#{not empty orcamentoController.orcamento and usuarioController.empresa.fabrica}" >
                                                    <p:outputLabel  value="Total Insumos" style="color: white; margin-left: 5%" />
                                                    <p:outputLabel value="#{orcamentoController.totalInsumos}"  style="color: white; margin-left: 5%" >
                                                        <f:convertNumber currencySymbol="R$" type="currency"/>
                                                    </p:outputLabel>
                                                </h:panelGrid>
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel  value="Valor Desconto" style="font-weight: bold; margin-left: 5%; " /> <br/>
                                            <p:inputText value="#{orcamentoController.descontoTotalVenda}"  style=" text-align: right; margin-left: 3%;margin-bottom: 3px;width: 95%" 
                                                         onkeyup="somenteNumeros(this);" 
                                                         disabled="#{orcamentoController.orcamento.status eq 'VENDA' or orcamentoController.orcamento.status eq 'CANCELADO' 
                                                                     or orcamentoController.acrescimoTotalVenda > 0 or empty orcamentoController.acrescimoTotalVenda }" >
                                                    <p:ajax event="change" listener="#{orcamentoController.calcularSubtotal()}" />
                                                </p:inputText>
                                            </p:column>  
                                            <p:column>
                                                <p:outputLabel  value="Valor Acréscimo" style="font-weight: bold;margin-left: 5%; " /><br/>
                                            <p:inputText value="#{orcamentoController.acrescimoTotalVenda}"  
                                                         style="text-align: right;  margin-left: 3%; margin-bottom: 3px; width: 95%" onkeyup="somenteNumeros(this);" 
                                                             disabled="#{orcamentoController.orcamento.status eq 'VENDA' or orcamentoController.orcamento.status eq 'CANCELADO' 
                                                                         or orcamentoController.descontoTotalVenda  > 0 or  empty orcamentoController.descontoTotalVenda}" >
                                                             <p:ajax event="change" listener="#{orcamentoController.calcularSubtotal()}" />
                                                         </p:inputText>
                                            </p:column>  
                                            <p:column>
                                                <h:panelGrid columns="1" style="background-color: skyblue;  width: 95%;border-radius: 10px 10px;" 
                                                         rendered="#{not empty orcamentoController.orcamento}" >
                                                <p:outputLabel  value="TOTAL GERAL" style="font-weight: bold;color: white; margin-left: 5%" />
                                                    <p:outputLabel value="#{orcamentoController.totalGeral}" style=" float: right;color: white; font-weight: bold;font-size: x-large !important; margin-left: 5%" >
                                                        <f:convertNumber currencySymbol="R$" type="currency"/>
                                                    </p:outputLabel>
                                                </h:panelGrid>
                                            </p:column>  
                                        </h:panelGrid>
                                    </p:column>
                                </p:column>
                            </h:panelGrid>
                        </h:panelGrid>
                        <br/>
                    </p:outputPanel>

                    <p:outputPanel id="listagem" rendered="#{orcamentoController.orcamento eq null}" style="max-height: 500px !important; overflow: scroll ">
                        <p:dataTable emptyMessage="Nenhum orçamento cadastrado"     lazy="true" reflow="true"  
                                     style="height: 100% "  scrollHeight="500" scrollable="true"  paginator="true" paginatorPosition="bottom"
                                     rowsPerPageTemplate="25,50,100,200,500,1000,99999999" rows="15"
                                     value="#{orcamentoController.model}"  var="u" >
                            <p:column headerText="#" width="5%">
                                <p:commandLink actionListener="#{orcamentoController.setOrcamento(u)}"  immediate="true" update="form" >
                                    <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                                </p:commandLink>
                            </p:column>
                            <p:column   width="13%" headerText="Codigo" filterBy="#{u.id}" style="text-align: left" >
                                <p:outputLabel value="#{u.id}" style="text-align: center" /> 
                            </p:column>
                            <p:column   width="30%" headerText="Cliente" filterBy="#{u.cliente.nome}" filterMatchMode="contains">
                                <p:outputLabel value="#{u.cliente.nome}"  /> 
                            </p:column>
                            <p:column  rendered="#{usuarioController.empresa.ramoAtividade.chave eq 'OFICINA'}"  width="13%" headerText="Placa" filterBy="#{u.placaVeiculo}" style="text-align: center">
                                <p:outputLabel value="#{u.placaVeiculo}" style="text-align: center" /> 
                            </p:column>
                            <p:column   width="16%" headerText="Profissional" filterBy="#{u.usuario.nome}" style="text-align: center" 
                                        rendered="#{usuarioController.empresa.ramoAtividade.chave ne 'OFICINA'}">
                                <p:outputLabel value="#{u.usuarioExecutante.nome}" style="text-align: center" /> 
                            </p:column>
                            <p:column   width="14%" headerText="Data"  style="text-align: center" sortBy="#{u.dataOrcamento}" >
                                <p:outputLabel value="#{u.dataOrcamento}" >
                                    <f:convertDateTime pattern="dd/MM/yyyy" />
                                </p:outputLabel>
                            </p:column>
                            <p:column   width="14%" headerText="Entrega"  style="text-align: center"  sortBy="#{u.dataEntregaPrevista}"  
                                        rendered="#{usuarioController.empresa.ramoAtividade.chave eq 'FABRICA' or usuarioController.empresa.ramoAtividade.chave eq 'OFICINA'}">
                                <p:outputLabel value="#{u.dataEntregaPrevista}" >
                                    <f:convertDateTime pattern="dd/MM/yyyy" />
                                </p:outputLabel>
                            </p:column>
                            <p:column   width="15%" headerText="Valor Total"   sortBy="#{u.valorTotal}"  style="text-align: center">
                                <p:outputLabel value="#{u.valorTotal }" style="text-align: right" >
                                    <f:convertNumber currencySymbol="R$" type="currency"/>
                                </p:outputLabel> 
                            </p:column>
                            <p:column   width="15%" headerText="Valor Saldo"  sortBy="#{u.valorSaldo}"  style="text-align: center">
                                <p:outputLabel value="#{u.valorSaldo }" style="text-align: right" >
                                    <f:convertNumber currencySymbol="R$" type="currency"/>

                                </p:outputLabel> 
                            </p:column>
                            <p:column   width="13%" headerText="STATUS"  sortBy="#{u.status}" style="text-align: center">
                                <p:outputLabel value="#{u.status.value}" style="text-align: center" /> 
                            </p:column>
                            <p:column width="5%" headerText="#" style="text-align: center"> 

                                <p:commandLink target="_blank" actionListener="#{orcamentoController.imprimirOrcamento(u)}" disabled="#{ u.status eq 'CANCELADO'}"   ajax="false"   >
                                    <h:graphicImage url="/Images/print.png"  width="20px" height="20px" />
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>
                    </p:outputPanel>

                    <p:outputPanel id="panelCabecalho" autoUpdate="true" rendered="#{not empty orcamentoController.orcamento}" 
                                   style="width: 100%; background-color: white;">
                    <h:panelGrid columns="5"  style="width: 100%; margin-left: 1%"  >
                            <p:column>
                                <p:outputLabel value="Profissional"  style="font-weight: bold"/><br/>
                                <p:inputText style="width: 70%; color: black; max-width: 200px" disabled="true" value="#{orcamentoController.orcamento.usuarioExecutante.nome}" />
                                <p:commandLink style="text-align: left" disabled="#{orcamentoController.disableAllFields}"  onclick="PF('dlgUsuario').show();" >
                                    <h:graphicImage url="/Images/search.png" style="vertical-align: bottom"  width="30px" height="30px"/>
                                </p:commandLink>
                            </p:column>
                            <p:column>
                                <p:outputLabel value="Cliente" style="font-weight: bold" /><br/>
                                <p:inputText style="width: 70%; color: black; background-color: white; font-weight: bold "  
                                             disabled="true" value="#{orcamentoController.orcamento.cliente.nome}"  >                                    
                                </p:inputText> 
                                <p:commandLink onclick="PF('dlgCliente').show();" disabled="#{orcamentoController.disableAllFields}" >
                                    <h:graphicImage url="/Images/search.png"  style="vertical-align: bottom"  width="30px" height="30px"/>
                                </p:commandLink>
                            </p:column>
                            <p:column rendered="#{usuarioController.empresa.fabrica}">
                                <p:outputLabel value="Tipo de Orcamento"   /><br/>
                                <p:inputText style="width: 70%; max-width: 200px"  disabled="true" value="#{orcamentoController.tipoOrcamento.descricao}"
                                             /> 							
                                <p:commandLink onclick="PF('dlgTpOrcamento').show();"   disabled="#{orcamentoController.disableAllFields}" >
                                    <h:graphicImage url="/Images/search.png"  style="vertical-align: bottom"  width="30px" height="30px"/>
                                </p:commandLink>
                            </p:column>
                            <p:column >
                                <p:outputLabel value="Tabela de preço"  style="font-weight: bold" /><br/>
                                <p:inputText style="width:70%; color: #000" disabled="true" value="#{orcamentoController.tabelaPreco.descricao}" /> 
                                <p:commandLink onclick="PF('dlgTblPreco').show();" disabled="#{orcamentoController.disableAllFields}" >
                                    <h:graphicImage url="/Images/search.png"  style="vertical-align: bottom"  width="30px" height="30px"/>
                                </p:commandLink>
                            </p:column>
                            <p:column>
                                <h:panelGrid columns="1" >
                                    <p:outputLabel value="Previsão de entrega" style="font-weight: bold" />
                                    <p:calendar value="#{orcamentoController.orcamento.dataEntregaPrevista}"  pattern="dd/MM/yyyy" mask="true" disabled="#{orcamentoController.disableAllFields}" >
                                    </p:calendar>
                                </h:panelGrid>
                            </p:column>
                        </h:panelGrid>
                    </p:outputPanel>
                    ´<p:outputPanel id="pnlVeiculoObs" style="width: 98%" autoUpdate="true" rendered="#{not empty orcamentoController.orcamento}" >
                        <style>
                            .colu1{
                            width: 40%;
                        }
                        .colu2{
                            width: 60%;
                        }
                    </style>
                    <h:panelGrid id="grdVeiculoObs" style="width: 100%" columns="2" cellpadding="3" cellspacing="3" columnClasses="colu1, colu2">

                            <h:panelGrid columns="2"  id="grdMult"  cellpadding="3" cellspacing="3" style="width: 100%;margin-left: 2%"   >
                                <p:column rendered="#{not empty orcamentoController.listarMultiplicadores()}" >
                                    <p:outputLabel value="Multiplicador"  style="font-weight: bold" /><br/>
                                    <p:inputText style=" color: #000" disabled="true" value="#{orcamentoController.orcamento.multiplicador.fator}" /> 
                                    <p:commandLink onclick="PF('dlgMultiplicador').show();" disabled="#{orcamentoController.disableAllFields}" >
                                        <h:graphicImage url="/Images/search.png"  style="vertical-align: bottom"  width="30px" height="30px"/>
                                    </p:commandLink>
                                </p:column>
                                <p:outputLabel value="Observações" style="font-weight: bold" /> <br />
                                <p:inputTextarea value="#{orcamentoController.orcamento.observacao}" 
                                                 disabled="#{orcamentoController.orcamento.status eq 'CANCELADO'}" style="width: 100%;" >
                                <p:ajax event="change" update="@this"/>
                                </p:inputTextarea> 
                        </h:panelGrid>
                    </h:panelGrid>
                </p:outputPanel>
                <br />

                <p:outputPanel id="panelItens" autoUpdate="true" rendered="#{not empty orcamentoController.orcamento}" style="width: 100%;  max-height: 300px;border-radius: 10px 10px; background-color: white" >
                        <p:outputLabel  value="Recalcular insumos automaticamente:" rendered="#{usuarioController.empresa.ramoAtividade.chave eq 'FABRICA' and orcamentoController.existeInsumos}" />
                        <p:selectBooleanCheckbox id="recalculoInsumo" style="margin-left: 1%" value="#{orcamentoController.recalcularInsumos}" 
                                                 disabled="#{orcamentoController.disableAllFields}" 
                                                 rendered="#{usuarioController.empresa.ramoAtividade.chave eq 'FABRICA' and orcamentoController.existeInsumos}" >
                            <p:ajax event="change" update="@this"/>
                        </p:selectBooleanCheckbox>
                        <p:tooltip  for="recalculoInsumo" value="Quando marcado, impede que seja alterado a quantidade previamente definida de um insumo" />


                        <p:commandButton value="ADICIONAR PRODUTO/SERVIÇO" style="background-color: green; color: white; margin-left: 84%" 
                                         onclick="PF('dlgProduto').show();" 
                                         disabled="#{orcamentoController.disableAllFields}" 
                                         rendered="#{not empty orcamentoController.orcamento}" />
                        <br/>
                        <p:dataTable emptyMessage="Nenhum item"     
                                     value="#{orcamentoController.orcamento.orcamentoItemList}"  var="p" >
                            <p:column  width="25%"  headerText="Produto/Serviço"  style="text-align: left">
                                <p:outputLabel value="#{p.produto.descricao} #{ usuarioController.empresa.ramoAtividade.chave ne 'OFICINA' ? orcamentoController.concatenaObservacao(p.observacao) :'' }" style="text-align: center" /> 
                            </p:column>
                            <p:column width="20%"  headerText="Veículo" rendered="#{usuarioController.empresa.ramoAtividade.chave eq 'OFICINA'}" >
                                <p:inputText value="#{p.observacao}" style="width: 85%; font-size: small; font-weight: bold; color: black" disabled="true"/>
                                <p:commandLink onsuccess="PF('dlgVeiculo').show();"  actionListener="#{orcamentoController.selecionarItem(p)}" 
                                               disabled="#{orcamentoController.disableAllFields}" >
                                    <h:graphicImage url="/Images/search.png"  style="vertical-align: bottom"  width="30px" height="30px"/>
                                </p:commandLink>


                            </p:column>
                            <p:column width="15%" headerText="Unidade" rendered="#{usuarioController.empresa.controlaEstoque}">
                                <p:selectOneMenu id="umed" value="#{p.unidadeMedidaSelecionada}" editable="true" disabled="#{orcamentoController.disableAllFields}"  >
                                    <f:selectItems value="#{orcamentoController.listarUnidadeMedidas(p.produto)}" />
                                    <p:ajax event="change" update="@this" listener="#{orcamentoController.atualizaItem(p)}" />

                                </p:selectOneMenu>
                            </p:column>
                            <p:column   width="13%" headerText="Vlr Unitário"  style="text-align: center">
                                <p:inputText  id="valorUnitario" value="#{p.valorUnitario}" onkeyup="somenteNumeros(this);"  
                                              disabled="#{(not empty p.tabelaPrecoItem.valorVenda and p.tabelaPrecoItem.valorVenda > 0 ) or (orcamentoController.orcamento.status eq 'VENDA' or orcamentoController.orcamento.status eq 'CANCELADO') }"  
                                              style="width: 80%; text-align: right; font-weight: bold;color: black" >
                                    <p:ajax event="change" listener="#{orcamentoController.calcularSubtotal()}"  update="total"  />
                                </p:inputText>
                            </p:column>
                            <p:column   width="9%" headerText="Qtd"  style="text-align: center">
                                <p:inputText  id="qtd" value="#{p.quantidade}" 
                                              disabled="#{orcamentoController.disableAllFields}" onkeyup="somenteNumeros(this);" style="width: 98%; text-align: right; color: black" >
                                    <p:ajax event="change" listener="#{orcamentoController.calcularSubtotal()}"  update="total"  />
                                </p:inputText>

                            </p:column>
                            <p:column   width="8%" headerText="$ Desc"  style="text-align: left">
                                <p:outputLabel value="#{p.valorDesconto}" style="width: 98%; text-align: center"  >
                                    <f:convertNumber currencySymbol="R$" type="currency"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column   width="8%" headerText="% Desc"  style="text-align: left">
                                <p:outputLabel value="#{p.percDesconto}" style="width: 98%; text-align: center"   />
                            </p:column>
                            <p:column   width="8%" headerText="$ Acresc"  style="text-align: left">
                                <p:outputLabel value="#{p.valorAcrescimo}" style="width: 98%; text-align: center"   >
                                    <f:convertNumber currencySymbol="R$" type="currency"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column   width="9%" headerText="% Acresc"  style="text-align: left">
                                <p:outputLabel value="#{p.percAcrescimo}" style="width: 98%; text-align: center"  />
                            </p:column>
                            <p:column   width="15%" headerText="Subtotal"  style="text-align: center">
                                <p:inputText readonly="true" id="total" value="#{p.valorTotal}"  style="width: 98%; text-align: center" >
                                    <f:convertNumber currencySymbol="R$" type="currency"/>
                                </p:inputText>
                            </p:column>
                            <p:column headerText="#" width="4%">
                                <p:commandLink   actionListener="#{orcamentoController.selecionarItem(p)}" disabled="#{ orcamentoController.disableAllFields}" immediate="true" onsuccess="PF('dlgEdit').show();"  >
                                    <h:graphicImage url="/Images/edit.png"  width="20px" height="20px" />
                                </p:commandLink>
                            </p:column>
                            <p:column headerText="#" width="4%">
                                <p:commandLink actionListener="#{orcamentoController.removeItem(p)}" disabled="#{orcamentoController.disableAllFields}"   >
                                    <h:graphicImage url="/Images/remove.png"  width="17px" height="17px" />
                                </p:commandLink>
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                    <p:dialog       widgetVar="dlgEdit" id="dlgEdit" height="350px" width="40%"  modal="true" header="Aplicar deconto/acrescimo">
                        <p:outputPanel autoUpdate="true" style="width: 99%">
                            <h:panelGrid columns="1" columnClasses="column1, column2" style="width: 99%; height: 99%">
                                <p:outputLabel value="#{orcamentoController.itemSelecionado.produto.descricao}"  style="text-align: right; font-weight: bold; font-size: x-large !important" />
                                <br/>
                                <p:outputLabel value="% desconto" style="font-weight: bold" />
                                <p:inputText value="#{orcamentoController.percDesconto}"  onkeyup="somenteNumeros(this);" style="text-align: right ; width: 30%" />
                                <p:outputLabel value="% acréscimo" style="font-weight: bold" />
                                <p:inputText  value="#{orcamentoController.percAcrescimo}" onkeyup="somenteNumeros(this);" style="text-align: right; width: 30% " />
                                <p:outputLabel value="Observação" style="font-weight: bold" />
                                <p:inputText  value="#{orcamentoController.observacao}" placeholder="DIGITE AQUI OS DETALHES DO ITEM PARA COMPOR A SUA DESCRIÇÃO"  style="text-align: right; width: 90% " />
                            </h:panelGrid>
                        </p:outputPanel>
                        <br/>

                        <p:outputPanel >
                            <h:commandButton value="CONFIRMAR" style="color: green; float: right" actionListener="#{orcamentoController.confirmaEdicao()}" />
                        </p:outputPanel>
                    </p:dialog>
                    <p:dialog  style="background-color: lightslategray;" 
                           widgetVar="dlgUsuario" id="dlgUsuario" height="400px" width="40%"  modal="true" header="Selecao de Profissional">
                    <p:dataTable    value="#{orcamentoController.listarUsuarios()}" var="u" scrollable="true" scrollRows="15" scrollHeight="500px"   >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.setUsuarioExecutante(u)}"  oncomplete="PF('dlgUsuario').hide();"   >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Nome" filterBy="#{u.nome}">
                            #{u.nome}   
                        </p:column>
                    </p:dataTable>
                </p:dialog>
                <p:dialog  style="background-color: lightslategray;"   dynamic="true"
                           widgetVar="dlgTblPreco" id="dlgTblPreco" height="500px" width="500px"  modal="true" header="Selecao de Precos">
                    <p:dataTable    value="#{orcamentoController.listarTabelasPreco()}" var="u" scrollable="true" scrollRows="15" scrollHeight="500px" >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.setTabelaPreco(u)}"  oncomplete="PF('dlgTblPreco').hide();"  >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Tabela" filterBy="#{u.descricao}">
                            #{u.descricao}   
                        </p:column>
                    </p:dataTable>
                    <p:commandLink value="NENHUM REGISTRO" style="color: white !important; float: right" actionListener="#{orcamentoController.setTabelaPreco(null)}" oncomplete="PF('dlgTblPreco').hide();"  />
                    </p:dialog>

                    <p:dialog  style="background-color: lightslategray;"  dynamic="true"
                           widgetVar="dlgTpOrcamento" id="dlgTpOrcamento" height="400px" width="50%"  modal="true" header="Selecao de tipo de orcamento">
                    <p:dataTable    value="#{orcamentoController.listarTipoOrcamentos()}" var="t" scrollable="true" scrollRows="15" scrollHeight="500px"  >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.setTipoOrcamento(t)}"  oncomplete="PF('dlgTpOrcamento').hide();"   >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Tipo de orcamento" filterBy="#{t.descricao}">
                            #{t.descricao}   
                        </p:column>
                    </p:dataTable>
                    <p:commandLink value="NENHUM REGISTRO" style="color: white !important; float: right" actionListener="#{orcamentoController.setTipoOrcamento(null)}" oncomplete="PF('dlgTpOrcamento').hide();"  />
                    </p:dialog>
                    <p:dialog  style="background-color: lightslategray;"   dynamic="true"
                           widgetVar="dlgTipoPgto" id="dlgTipoPgto" height="400px" width="40%"  modal="true" header="Selecao de tipo de pagamento">
                    <p:dataTable    value="#{orcamentoController.listarTipoPagamentos()}" var="t" scrollable="true" scrollRows="15" scrollHeight="500px"   >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.orcamento.setTipoPagamento(t)}" oncomplete="PF('dlgConfirmacao').show();"  onclick="PF('dlgTipoPgto').hide();"   >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Tipo de Pagamento" filterBy="#{t.descricao}">
                            #{t.descricao}   
                        </p:column>
                    </p:dataTable>
                    <p:commandLink value="NENHUM REGISTRO" style="color: white !important; float: right" actionListener="#{orcamentoController.orcamento.setTipoPagamento(null)}" oncomplete="PF('dlgTipoPgto').hide();"  />
                    </p:dialog>
                    <p:dialog  style="background-color: lightslategray;"  dynamic="true"
                           widgetVar="dlgFrmPagamento" id="dlgFrmPagamento" height="500px" width="50%"  modal="true" header="Selecao de forma de pagamento">
                    <p:dataTable    value="#{orcamentoController.listarFormaPagamentos()}" var="t" scrollable="true" scrollRows="15" scrollHeight="500px"  >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.orcamento.setFormaPagamento(t)}" oncomplete="PF('dlgConfirmacao').show();" onclick="PF('dlgFrmPagamento').hide();" >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Forma pagamento" filterBy="#{t.descricao}">
                            #{t.descricao}   
                        </p:column>
                        <p:column headerText="Num Parcelas" filterBy="#{t.numeroParcelas}">
                            #{t.numeroParcelas}   
                        </p:column>
                    </p:dataTable>
                    <p:commandLink value="NENHUM REGISTRO" style="color: white !important; float: right" actionListener="#{orcamentoController.orcamento.setFormaPagamento(null)}" oncomplete="PF('dlgFrmPagamento').hide();"  />
                    </p:dialog>
                    <p:dialog  style="background-color: lightslategray;"   dynamic="true"
                           widgetVar="dlgCliente" id="dlgCliente" height="500px" width="50%"  modal="true" header="Selecao de Clientes">
                    <p:dataTable     value="#{orcamentoController.listarClientes()}" var="i"  scrollable="true" scrollRows="15" scrollHeight="500px"  >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.orcamento.setCliente(i)}"   oncomplete="PF('dlgCliente').hide();"   >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />                               
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Cliente" filterBy="#{i.nome}">
                            #{i.nome}   
                        </p:column>
                        <p:column headerText="Cpf/Cnpj" filterBy="#{i.cpfCnpj}">
                            #{i.cpfCnpj}   
                        </p:column>
                    </p:dataTable>
                    <p:commandLink value="NENHUM REGISTRO" style="color: white !important; float: right" 
                                   actionListener="#{orcamentoController.orcamento.setCliente(null)}" oncomplete="PF('dlgCliente').hide();"  update="@this"/>
                        <p:commandButton value="NOVO CLIENTE" onclick="PF('dlgNovoCliente').show();" actionListener="#{orcamentoController.novoCliente()}" onsuccess="PF('dlgCliente').hide();" />
                    </p:dialog>
                    <p:dialog  style="background-color: lightslategray;"   dynamic="true"
                           widgetVar="dlgProduto" id="dlgProduto" height="500px" width="65%"  modal="true" header="Selecao de Produtos">
                    <p:dataTable     value="#{orcamentoController.listarProdutos()}" var="c" 
                                     scrollable="true" scrollHeight="400" scrollRows="20"  >
                        <p:column headerText="#" width="5%">
                            <p:commandLink actionListener="#{orcamentoController.addProduto(c)}"   >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Cód.Barras" width="18%" filterBy="#{c.codigoBarras}">
                            #{c.codigoBarras}   
                        </p:column>
                        <p:column headerText="Produto" width="30%" filterBy="#{c.descricao}">
                            #{c.descricao}   
                        </p:column>
                        <p:column headerText="Tipo" width="17%" filterBy="#{c.tipoProduto.descricao}">
                            #{c.tipoProduto.descricao}   
                        </p:column>
                        <p:column headerText="Fornecedor" width="20%" filterBy="#{c.fornecedor.nome}">
                            #{c.fornecedor.nome}   
                        </p:column>
                        <p:column headerText="Estoque" width="10%" rendered="#{usuarioController.empresa.controlaEstoque}" >
                            #{c.estoque.quantidade}
                        </p:column>
                        <p:column headerText="Un.Med" width="10%" rendered="#{usuarioController.empresa.controlaEstoque}" >
                            #{c.estoque.unidadeMedida.sigla}
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="NOVO PRODUTO/SERVIÇO" onclick="PF('dlgNovoProduto').show();" 
                                     actionListener="#{orcamentoController.novoProduto()}" style="background-color: #358ccb;color: white; " onsuccess="PF('dlgProduto').hide();" />

                    <p:commandButton style="color: white; background-color: green; float: right; width: 30%"   update="form"
                                     onclick="PF('dlgProduto').hide();" value="CONFIRMAR"  >
                        </p:commandButton>
                    </p:dialog>
                    <p:dialog     dynamic="true"
                        widgetVar="dlgNovoCliente" id="dlgNovoCliente" height="500px" width="50%"  modal="true" header="Cadastro rápido cliente">
                        <h:panelGrid columns="1" cellpadding="2" cellspacing="2" style="margin-left: 1%; width: 90%" >
                            <p:outputLabel value="Nome" style="font-weight: bold; margin-top: 5px" />
                            <p:inputText  value="#{orcamentoController.cliente.nome}" style="width: 90%"/>
                            <p:outputLabel value="CPF/CNPJ" style="font-weight: bold" />
                            <p:inputText value="#{orcamentoController.cliente.cpfCnpj}" style="width: 50%" />
                            <p:outputLabel value="RG" style="font-weight: bold" />
                            <p:inputText value="#{orcamentoController.cliente.rg}" style="width: 50%" />
                            <p:outputLabel value="Email" style="font-weight: bold" />
                            <p:inputText value="#{orcamentoController.cliente.email}" style="width: 90%" />
                            <p:outputLabel value="Telefone" style="font-weight: bold" />
                            <p:inputText value="#{orcamentoController.cliente.telefone}" style="width: 40%" />
                            <p:outputLabel value="Observações" style="font-weight: bold" />
                            <p:inputTextarea value="#{orcamentoController.cliente.observacao}" style="width: 90%" />
                        </h:panelGrid>
                        <p:outputPanel autoUpdate="true">

                            <h:panelGrid columns="2" cellpadding="2" columnClasses="columnCidade1, columnCidade2" cellspacing="2" style="margin-left: 1% ; margin-top: 1%" >
                                <p:column>
                                    <p:outputLabel value="Cidade" style="font-weight: bold" />  <br/>
                                    <p:inputText disabled="true" value="#{orcamentoController.cliente.cidade.nome}" />
                                </p:column>
                                <p:column>
                                    <p:commandLink onclick="PF('dlgCidade').show();" style="margin-bottom: 0px" >
                                        <h:graphicImage url="/Images/search.png"  width="27px" height="27px"/>
                                    </p:commandLink>
                                </p:column>
                            </h:panelGrid>
                        </p:outputPanel>
                        <p:commandButton value="SALVAR"  style="float:right" actionListener="#{orcamentoController.salvarNovoCliente()}"  onsuccess="PF('dlgNovoCliente').hide();"  />
                    </p:dialog>
                    <p:dialog    dynamic="true"
                        widgetVar="dlgNovoProduto" id="dlgNovoProduto" height="300px" width="40%"  modal="true" header="Cadastro rápido Produto">
                        <p:outputPanel autoUpdate="true">
                            <h:panelGrid columns="2" columnClasses="columnCidade1, columnCidade2" cellpadding="2" cellspacing="2" style="margin-left: 1%; width: 100%"  >
                                <p:column>
                                    <p:outputLabel value="Tipo de produto" style="font-weight: bold" /> <br/>
                                    <p:inputText disabled="true" value="#{orcamentoController.produto.tipoProduto.descricao}" style="width: 98%" />
                                </p:column>
                                <p:column>
                                    <p:commandLink onclick="PF('dlgTpProduto').show();" >
                                        <h:graphicImage url="/Images/search.png"  width="27px" height="27px"/>
                                    </p:commandLink>
                                </p:column>
                            </h:panelGrid>
                        </p:outputPanel>

                        <h:panelGrid columns="1" cellpadding="2" cellspacing="2" style="margin-left: 1%; width: 90%" >
                            <p:outputLabel value="Descrição" style="font-weight: bold; margin-top: 5px" />
                            <p:inputText  value="#{orcamentoController.produto.descricao}" style="width: 90%"/>
                        </h:panelGrid>


                        <p:commandButton value="SALVAR"  style="float:right" actionListener="#{orcamentoController.gravarNovoProduto()}"  onsuccess="PF('dlgNovoProduto').hide();"  />
                    </p:dialog>
                    <p:dialog  style="background-color: lightslategray;"  dynamic="true"
                           widgetVar="dlgTpProduto" id="dlgTpProduto" height="400px" width="50%"  modal="true" header="Seleção de tipo de produto">
                    <p:dataTable    value="#{orcamentoController.listarTiposProduto()}" var="c" scrollable="true" scrollHeight="400px" scrollRows="15" >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.produto.setTipoProduto(c)}"  oncomplete="PF('dlgTpProduto').hide();" >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Tipo Produto" filterBy="#{c.descricao}">
                            #{c.descricao}   
                        </p:column>
                    </p:dataTable>
                </p:dialog>

                <p:dialog  style="background-color: lightslategray;"  dynamic="true"
                           widgetVar="dlgCidade" id="dlgCidade" height="500px" width="50%"  modal="true" header="Seleção de Cidade">
                    <p:dataTable    value="#{orcamentoController.listarCidades()}" var="c" scrollable="true" scrollRows="20" scrollHeight="500px" >
                        <p:column headerText="#" width="8%">
                            <p:commandLink actionListener="#{orcamentoController.cliente.setCidade(c)}"   oncomplete="PF('dlgCidade').hide();" >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>

                        <p:column headerText="Nome" filterBy="#{c.nome}" width="80%" >
                            #{c.nome}   
                        </p:column>
                        <p:column headerText="UF" filterBy="#{c.estado.sigla}">
                            #{c.estado.sigla}
                        </p:column>
                    </p:dataTable>
                </p:dialog>
                <p:dialog  style="background-color: lightslategray;"  dynamic="true"
                           widgetVar="dlgMultiplicador" id="dlgMultiplicador" height="400px" width="400px" modal="true" header="Seleção de Multiplicador">
                    <p:dataTable    value="#{orcamentoController.listarMultiplicadores()}" var="m" scrollable="true" scrollRows="20" scrollHeight="500px" >
                        <p:column headerText="#" width="9%">
                            <p:commandLink actionListener="#{orcamentoController.aplicarMultiplicador(m)}"   oncomplete="PF('dlgMultiplicador').hide();" >
                                <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                            </p:commandLink>
                        </p:column>

                        <p:column headerText="Fator" filterBy="#{m.fator}" width="90%" >
                            <p:outputLabel value="#{m.fator}"  >
                                <f:convertNumber maxFractionDigits="1" />
                            </p:outputLabel>
                        </p:column>
                        <p:column headerText="Padrão" filterBy="#{m.padrao}">
                            #{m.padrao ? 'SIM' : 'NÃO'}
                        </p:column>
                    </p:dataTable>
                    <p:commandLink value="NENHUM REGISTRO" style="color: white !important; float: right" actionListener="#{orcamentoController.aplicarMultiplicador(null)}" oncomplete="PF('dlgMultiplicador').hide();" update="@this" />
                    </p:dialog>

                <p:dialog  style="background-color: lightslategray; "   dynamic="true"
                           widgetVar="dlgVeiculo" id="dlgVeiculo" height="400px" width="700px" modal="true" header="Seleção de Veiculos">
                        <p:outputPanel id="panelVeiculo"  >
                            <p:dataTable  id="tbVeiculo" value="#{orcamentoController.listarVeiculos()}" var="m" scrollable="true"  scrollHeight="400px"  >
                            <p:column headerText="#" width="9%">
                                <p:commandLink actionListener="#{orcamentoController.addVeiculo(m)}"   oncomplete="PF('dlgVeiculo').hide();" >
                                    <h:graphicImage url="/Images/select-icon.png"  width="20px" height="20px" />
                                </p:commandLink>
                            </p:column>

                            <p:column headerText="Veiculo" filterBy="#{m.veiculo}" filterMatchMode="contains" width="40%" >
                                <p:outputLabel value="#{m.veiculo}"  />
                            </p:column>
                            <p:column headerText="Placa" filterBy="#{m.placaVeiculo}" filterMatchMode="contains" width="20%">
                                #{m.placaVeiculo}
                            </p:column>
                            <p:column headerText="Cliente" filterBy="#{m.cliente.nome}" filterMatchMode="contains" width="45%">
                                #{m.cliente.nome}
                            </p:column>

                        </p:dataTable>
                    </p:outputPanel>


                    <p:commandLink value="NENHUM REGISTRO" style="color: white !important; float: right" 
                                   actionListener="#{orcamentoController.removerVeiculo()}" oncomplete="PF('dlgVeiculo').hide();"  update="@this"/>
                        <p:commandButton value="NOVO VEÍCULO" onclick="PF('dlgNovoVeiculo').show();" actionListener="#{orcamentoController.novoVeiculo()}" onsuccess="PF('dlgVeiculo').hide();" />
                    </p:dialog>

                    <style>
                        .columnConf1{
                        vertical-align: bottom;
                    }
                    .columnConf2{
                        vertical-align: bottom;
                    }
                </style>

                <p:dialog  style="background-color: whitesmoke;" 
                           widgetVar="dlgConfirmacao" id="dlgConfirmacao" responsive="true" dynamic="true" height="350px" width="400px"  modal="true" header="CONFIRMAR #{orcamentoController.venda ? 'VENDA' : 'ORÇAMENTO'}">
                    <p:outputPanel autoUpdate="true" rendered="#{orcamentoController.venda}">

                        <h:panelGrid columns="1" style="width: 98%; height: 200px; background-color: whitesmoke;">
                            <h:panelGrid columnClasses="columnConf1,columnConf2" columns="2" style="width: 100%">
                                    <p:column>
                                        <p:outputLabel value="Forma Pagamento" style="font-weight: bold"  /> <br/>
                                        <p:inputText  style="width: 95%"  readonly="true" value="#{orcamentoController.orcamento.formaPagamento.descricao}" /> 							
                                    </p:column>
                                    <p:column>
                                        <p:commandLink   onclick="PF('dlgFrmPagamento').show();" oncomplete="PF('dlgConfirmacao').hide();" >
                                            <h:graphicImage url="/Images/search.png"  style="vertical-align: bottom"  width="30px" height="30px"/>
                                        </p:commandLink>
                                    </p:column>
                                </h:panelGrid>
                                <h:panelGrid  columnClasses="columnConf1,columnConf2" columns="2" style="width: 100%" >
                                    <p:column>
                                        <p:outputLabel value="Tipo Pagamento" style="font-weight: bold" /> <br/>
                                        <p:inputText  style="width: 95%" readonly="true"  value="#{orcamentoController.orcamento.tipoPagamento.descricao}" /> 							
                                    </p:column>
                                    <p:column>
                                        <p:commandLink   onclick="PF('dlgTipoPgto').show();" oncomplete="PF('dlgConfirmacao').hide();"  >
                                            <h:graphicImage url="/Images/search.png"  style="vertical-align: bottom"  width="30px" height="30px"/>
                                        </p:commandLink>
                                    </p:column>
                                    <p:outputLabel value="Data primeiro vcto" style="font-weight: bold" /><br/>
                                    <p:calendar value="#{orcamentoController.orcamento.dataVencimento}"  
                                                pattern="dd/MM/yyyy" mask="true" disabled="#{orcamentoController.disableAllFields}" />

                                </h:panelGrid>
                            </h:panelGrid>
                        </p:outputPanel>
                        <p:outputLabel value="Deseja realmente confirmar a operação?" style="font-weight: bold; font-size: large" rendered="#{not orcamentoController.venda}"/>
                        <br/>
                        <br/>
                        <br/>
                        <br/>
                        <p:commandButton style="color: white; background-color: green; float: right; width: 30%; height: 40px"  
                                         actionListener="#{orcamentoController.salvar(false)}" value="CONFIRMAR"   oncomplete="PF('dlgConfirmacao').hide();"  >
                        </p:commandButton>
                        <p:commandButton style="color: white; background-color: gray; float: left; width: 30%; height: 40px"  
                                         value="CANCELAR"   oncomplete="PF('dlgConfirmacao').hide();"  >
                        </p:commandButton>
                    </p:dialog>

                    <p:dialog   
                        widgetVar="dlgNovoVeiculo" id="dlgNovoVeiculo" height="300px" width="50%"  modal="true" header="Cadastro rápido veículo">
                        <h:panelGrid columns="1" cellpadding="2" cellspacing="2" style="margin-left: 1%; width: 90%" >
                            <p:outputLabel value="Veículo" style="font-weight: bold; margin-top: 5px" />
                            <p:inputText  value="#{orcamentoController.veiculoCliente.veiculo}" style="width: 90%"/>
                            <p:outputLabel value="Placa" style="font-weight: bold" />
                            <p:inputText value="#{orcamentoController.veiculoCliente.placaVeiculo}" style="width: 50%" />

                            <p:commandButton value="SALVAR"  style="float:right" 
                                             actionListener="#{orcamentoController.salvarNovoVeiculo()}"  onsuccess="PF('dlgNovoVeiculo').hide();"  />
                        </h:panelGrid>
                    </p:dialog>

                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Excluir" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                        <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                    </p:confirmDialog>
                </h:form>
            </h:body>

        </html>



